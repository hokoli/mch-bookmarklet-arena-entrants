<!DOCTYPE html>
<html>
<head>
    <title>MCH Bookmarklet</title>
</head>
<body>
    <h1>MCH Arena Entrants Bookmarklet</h1>
    <p>下のリンクをブックマークバーにドラッグ&ドロップしてください：</p>
    <a href="javascript:(async function(){function getUserListFromArena(){return Array.from(document.querySelectorAll('.groupUserList__item')).map(item=>{const spans=item.querySelectorAll('span');if(spans.length>=2){return{userName:spans[0].textContent.trim(),userId:spans[1].textContent.trim().replace('#','')}}return%20null}).filter(user=%3Euser&&user.userName&&user.userId)}function%20getUserListFromTournament(){const%20tournamentRounds=document.querySelectorAll('.tournament__tournament__round');if(tournamentRounds.length===0)return[];const%20firstRound=tournamentRounds[0];const%20userElements=firstRound.querySelectorAll('.userName');return%20Array.from(userElements).map(el=%3E{const%20link=el.closest('a');if(!link||link.querySelector('.tournamentMatch__user--empty'))return%20null;const%20nameSpan=el.querySelector('.userName__name');const%20uidSpan=el.querySelector('.userName__uid');if(nameSpan&&uidSpan){return{userName:nameSpan.textContent.trim(),userId:uidSpan.textContent.trim().replace('#','')}}return%20null}).filter(user=%3Euser&&user.userName&&user.userId)}function%20getUserList(){const%20arenaUsers=getUserListFromArena();if(arenaUsers.length%3E0)return%20arenaUsers;return%20getUserListFromTournament()}async%20function%20getUserAddress(userId){try{const%20response=await%20fetch(%60https://www.mycryptoheroes.net/api/proxy/mch/users/${userId}%60);if(response.ok){const%20data=await%20response.json();return%20data.user_data?.eth||''}return''}catch(error){console.warn(%60%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E5%8F%96%E5%BE%97%E3%82%A8%E3%83%A9%E3%83%BC%20(User%20${userId}):%60,error);return''}}async%20function%20getYukichiCoins(address,userId){return''}async%20function%20getInuBalance(address,userId){try{const%20tokenContract='0x6b7b5F6D7411F374694595d05719ad2f060aAC61';const%20balanceOfData='0x70a08231'+address.substring(2).padStart(64,'0');const%20response=await%20fetch('https://rpc.mainnet.oasys.games',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_call',params:[{to:tokenContract,data:balanceOfData},'latest'],id:1})});if(response.ok){const%20data=await%20response.json();if(data.result&&data.result!=='0x'&&data.result!=='0x0'){const%20balanceHex=data.result;const%20balanceBigInt=BigInt(balanceHex);return%20Math.floor(Number(balanceBigInt)).toString()}}return'0'}catch(error){console.warn(%60InuBalance%E5%8F%96%E5%BE%97%E3%82%A8%E3%83%A9%E3%83%BC%20(User%20${userId}):%60,error);return'0'}}function%20downloadCSV(users){const%20csvHeader='%E3%83%A6%E3%83%BC%E3%82%B6ID,%E3%83%A6%E3%83%BC%E3%82%B6%E5%90%8D,%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9,yukichi%E7%99%BA%E8%A1%8C%E3%82%B3%E3%82%A4%E3%83%B3,InuBalance\n';const%20csvRows=users.map(user=%3E%60${user.userId},%22${user.userName}%22,%22${user.address}%22,%22${user.yukichiCoin}%22,${user.inuBalance}%60).join('\n');const%20csvContent=csvHeader+csvRows;const%20blob=new%20Blob(['\uFEFF'+csvContent],{type:'text/csv;charset=utf-8;'});const%20link=document.createElement('a');const%20url=URL.createObjectURL(blob);link.setAttribute('href',url);link.setAttribute('download',%60mch_users_${new%20Date().toISOString().split('T')[0]}.csv%60);link.style.visibility='hidden';document.body.appendChild(link);link.click();document.body.removeChild(link)}const%20userList=getUserList();if(userList.length===0){alert('%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%83%AA%E3%82%B9%E3%83%88%E3%81%8C%E8%A6%8B%E3%81%A4%E3%81%8B%E3%82%8A%E3%81%BE%E3%81%9B%E3%82%93%E3%80%82%E6%AD%A3%E3%81%97%E3%81%84%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%A7%E3%83%96%E3%83%83%E3%82%AF%E3%83%9E%E3%83%BC%E3%82%AF%E3%83%AC%E3%83%83%E3%83%88%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84%E3%80%82');return}const%20loadingDiv=document.createElement('div');loadingDiv.style.cssText=%60position:%20fixed;%20top:%2050%;%20left:%2050%;%20transform:%20translate(-50%,%20-50%);%20background:%20rgba(0,0,0,0.8);%20color:%20white;%20padding:%2020px;%20border-radius:%2010px;%20z-index:%2010000;%20font-family:%20Arial,%20sans-serif;%60;loadingDiv.innerHTML='%3Cdiv%3E%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E5%8F%96%E5%BE%97%E4%B8%AD...%3C/div%3E%3Cdiv%20id=%22progress%22%3E0/0%3C/div%3E';document.body.appendChild(loadingDiv);const%20users=[];const%20progressDiv=document.getElementById('progress');for(let%20i=0;i%3CuserList.length;i++){const%20user=userList[i];progressDiv.textContent=%60${i+1}/${userList.length}%20-%20%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%20${user.userId}%20%E3%82%92%E5%87%A6%E7%90%86%E4%B8%AD...%60;const%20address=await%20getUserAddress(user.userId);let%20yukichiCoin='';let%20inuBalance='0';if(address){yukichiCoin=await%20getYukichiCoins(address,user.userId);inuBalance=await%20getInuBalance(address,user.userId)}users.push({userId:user.userId,userName:user.userName,address:address,yukichiCoin:yukichiCoin,inuBalance:inuBalance});await%20new%20Promise(resolve=%3EsetTimeout(resolve,100))}downloadCSV(users);document.body.removeChild(loadingDiv);alert(%60${users.length}%E4%BA%BA%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92CSV%E3%81%A7%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F%E3%80%82%60);})();">MCH Arena Entrants</a>
</body>
</html>